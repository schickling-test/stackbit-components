#!/usr/bin/env node

const path = require('path');
const fse = require('fs-extra');
const componentsManifest = require('./src/components-manifest.json');

function generateStorybookDynamicComponents() {
    console.log('generating .storybook/storybook-dynamic.js ...');
    const joined = Object.entries(componentsManifest)
        .filter(([_, component]) => component.isDynamic)
        .map(([_, component]) => {
            return `${component.modelName}: ${component.path.split('/')[0]}.${component.className}`;
        })
        .join(',\n    ');

    const result = `// ⚠️ This file is autogenerated by build-component-maps.js
// To update this file, change src/components-manifest.json and re-run build-component-maps.js

import { components, layouts } from '../src';

const dynamicComponents = {
    ${joined}
};

export default dynamicComponents;
`;
    fse.writeFileSync(path.join(__dirname, '.storybook/storybook-dynamic.js'), result, 'utf8');
    console.log('generated .storybook/storybook-dynamic.js');
}

module.exports = generateStorybookDynamicComponents;

if (require.main === module) {
    generateStorybookDynamicComponents();
}
